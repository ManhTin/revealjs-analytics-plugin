!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).RevealPPTracking=t()}(this,(function(){"use strict";
/*!
   * revealjs-pp-tracking plugin v1.0.0
   * Manh Tin Nguyen
   * MIT licensed
   *
   * Copyright (C) 2025 Manh Tin Nguyen
   */class e{constructor(){this.hours=0,this.minutes=0,this.seconds=0}start(){this.timer?console.log("The timer is already running."):this.timer=setInterval((()=>{this._incrementSecond()}),1e3)}reset(){this.clear(),this.start()}clear(){this.timer&&(clearInterval(this.timer),this.timer=void 0),this.hours=0,this.minutes=0,this.seconds=0}toString(){return`${this.hours>9?this.hours:`0${this.hours}`}:${this.minutes>9?this.minutes:`0${this.minutes}`}:${this.seconds>9?this.seconds:`0${this.seconds}`}`}_incrementSecond(){this.seconds++,this.seconds>=60&&(this.seconds=0,this.minutes++,this.minutes>=60&&(this.minutes=0,this.hours++))}}
/*!
   * revealjs-pp-tracking plugin v1.0.0
   * Manh Tin Nguyen
   * MIT licensed
   *
   * Copyright (C) 2025 Manh Tin Nguyen
   */return()=>{const t={apiConfig:{},dwellTimes:!0,links:!0,media:!0,slideTransitions:!0,revealDependencies:{quiz:!1},debug:!1,...Reveal.getConfig().ppTracking};let n=[];if(void 0===t.apiConfig.trackingAPI)return void console.error("You have no trackingAPI configured where to send tracking data to!");function i(){return!0===t.dwellTimes||t.dwellTimes.perSlide}function r(){return!0===t.links||t.links.internal}function s(){return!0===t.links||t.links.external}function o(){return!0===t.media||t.media.audio}function a(){return!0===t.media||t.media.video}const l=window.location.href.replace(/(#(.+)?)/,""),d=["slidechanged","ready"],u=new e,c=new e,m={};function f(e){Reveal.getIndices(e);return Reveal.getSlides().indexOf(e)+1}function h(e){n.push({presentationId:t.apiConfig.presentationId,...e,timestamp:(new Date).toISOString(),url:l})}function g(){window.addEventListener("beforeunload",(()=>{h({eventName:"exit",slideNumber:f(Reveal.getCurrentSlide()),data:{finalProgress:Reveal.getProgress(),dwellTime:i()?c.toString():null,totalDwellTime:!0===t.dwellTimes||t.dwellTimes.total?u.toString():null}}),n.length>0&&(t.debug&&console.log("ðŸš€ ~ _sentData ~ events:",n),navigator.sendBeacon(t.apiConfig.trackingAPI,JSON.stringify(n)),n=[])}))}function v(){if(o()||a()){function e(){const e=document.querySelectorAll(o()&&a()?"audio, video":o()?"audio":"video");for(const t of e){const e=Reveal.getCurrentSlide(),n=t.tagName.toLowerCase();t.onplay||(t.onplay=function(){h({eventName:`${n}_play`,slideNumber:f(e),data:{id:this.id,mediaSource:this.currentSrc,currentTime:this.currentTime,duration:this.duration}})}),t.onpause||(t.onpause=function(){h({eventName:`${n}_pause`,slideNumber:f(e),data:{id:this.id,mediaSource:this.currentSrc,finished:this.ended,progress:this.currentTime/this.duration,currentTime:this.currentTime,duration:this.duration}})})}}Reveal.addEventListener("ready",e),Reveal.addEventListener("fragmentshown",e),Reveal.addEventListener("fragmenthidden",e),Reveal.addEventListener("slidechanged",e)}}function p(){!function(){for(const e of d)Reveal.addEventListener(e,(t=>{("slidechanged"!==e||t.previousSlide)&&h({eventName:e,slideNumber:f(t.currentSlide)})}))}(),i()&&Reveal.addEventListener("slidechanged",(e=>{e.previousSlide&&(h({eventName:"dwellTimePerSlide",slideNumber:f(e.previousSlide),data:{dwellTime:c.toString()}}),c.reset())})),g(),(r()||s())&&document.addEventListener("click",(e=>{if(!Array.from(Reveal.getCurrentSlide().querySelectorAll("a")).includes(e.target))return!0;const t=window.location.href.replace(new RegExp(window.location.hash)||"",""),n=e.target.href.replace(t,"");if("#"===n)return!0;const i=n.startsWith("#");if(i&&r()||!i&&s()){const t=i?"internalLink":"externalLink",r=i?n:e.target.href;h({eventName:"linkClick",slideNumber:f(Reveal.getCurrentSlide()),data:{linkType:t,href:r,linkText:e.target.text.trim()}})}})),v(),function(){if(t.revealDependencies.quiz){const n=Reveal.getConfig().quiz||{};function i(){const t=Reveal.getCurrentSlide(),n=t.querySelector("[data-quiz]").dataset.quiz;if(!n)return!0;const i=window[n];if(!i)return!0;m[n]instanceof e?m[n].reset():(m[n]=new e,m[n].start());const r={id:n,name:i.info.name,topic:i.info.main,numberOfQuestions:i.questions.length};h({eventName:"quiz_start",slideNumber:f(t),data:r})}function r(t){const n=Reveal.getCurrentSlide().querySelector("[data-quiz]").dataset.quiz;if(!n)return!0;const i=window[n];if(!i)return!0;let r;m[n]instanceof e&&(r=m[n].toString(),m[n].clear());const s={id:n,name:i.info.name,topic:i.info.main,numberOfQuestions:i.questions.length};h({eventName:"quiz_complete",slideNumber:f(Reveal.getCurrentSlide()),data:{...s,dwellTime:r,completed:!0,score:t.score}})}if(n.events=n.events||{},n.events.onStartQuiz){const s=n.events.onStartQuiz;n.events.onStartQuiz=()=>{i(),s()}}else n.events.onStartQuiz=()=>{i()};if(n.events.onCompleteQuiz){const o=n.events.onCompleteQuiz;n.events.onCompleteQuiz=e=>{r(e),o(e)}}else n.events.onCompleteQuiz=e=>{r(e)};prepareQuizzes(n)}}()}return{id:"pp-tracking",init:e=>{const t=e.getConfig();p(),i()?(u.start(),c.start()):u.start(),t.ppTracking.debug&&(console.log("Initialized pp-tracking plugin"),console.log("Plugin Config:",t.ppTracking))}}}}));
