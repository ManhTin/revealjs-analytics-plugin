!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).RevealPPTracking=t()}(this,(function(){"use strict";const e="INTERNAL",t="EXTERNAL",n="AUDIO",i="VIDEO",o="PLAY",s="PAUSE",r="START",a="COMPLETE",l={apiConfig:{},dwellTimes:!0,links:!0,media:!0,slideTransitions:!0,revealDependencies:{quiz:!1},debug:!1};
/*!
   * revealjs-pp-tracking plugin v1.0.0
   * Manh Tin Nguyen
   * MIT licensed
   *
   * Copyright (C) 2025 Manh Tin Nguyen
   */
class d{constructor(){this.seconds=0}start(){this.timer?console.log("The timer is already running."):this.timer=setInterval((()=>{this.seconds++}),1e3)}reset(){this.clear(),this.start()}clear(){this.timer&&(clearInterval(this.timer),this.timer=void 0),this.seconds=0}getTime(){return this.seconds}toString(){const e=Math.floor(this.seconds/3600),t=Math.floor(this.seconds%3600/60),n=this.seconds%60;return`${e>9?e:`0${e}`}:${t>9?t:`0${t}`}:${n>9?n:`0${n}`}`}}const c=e=>Reveal.getSlides().indexOf(e)+1,u=e=>!0===e.dwellTimes||e.dwellTimes.total,p=e=>!0===e.dwellTimes||e.dwellTimes.perSlide,g=e=>!0===e.links||e.links.internal,m=e=>!0===e.links||e.links.external,f=e=>!0===e.media||e.media.audio,v=e=>!0===e.media||e.media.video,h=(e,t)=>{if(!f(e)&&!v(e))return;const r=()=>{const r=(e=>document.querySelectorAll(f(e)&&v(e)?"audio, video":f(e)?"audio":"video"))(e),a=Reveal.getCurrentSlide();for(const l of r){const r={mediaId:l.id,mediaType:"AUDIO"===l.tagName?n:i,presentationId:e.apiConfig.presentationId,presentationUrl:window.location.href.replace(/(#(.+)?)/,"")};l.onplay||(l.onplay=function(){t.push({timestamp:(new Date).toISOString(),actionType:o,slideNumber:c(a),mediaSource:this.currentSrc,currentTime:Number.parseInt(this.currentTime,10),totalDuration:Number.parseInt(this.duration,10),...r}),e.debug&&console.log("ðŸš€ Media played:",t)}),l.onpause||(l.onpause=function(){t.push({timestamp:(new Date).toISOString(),actionType:s,slideNumber:c(a),mediaSource:this.currentSrc,currentTime:Number.parseInt(this.currentTime,10),totalDuration:Number.parseInt(this.duration,10),progress:this.currentTime/this.duration,finished:this.ended,...r})})}};Reveal.addEventListener("ready",r),Reveal.addEventListener("fragmentshown",r),Reveal.addEventListener("fragmenthidden",r),Reveal.addEventListener("slidechanged",r)};return()=>{const n={...l,...Reveal.getConfig().ppTracking},i={logPresentationViewEvents:[],logSlideViewEvents:[],logLinkActionEvents:[],logMediaActionEvents:[],logQuizActionEvents:[]};if(!n.apiConfig.trackingAPI)return console.error("You have no trackingAPI configured where to send tracking data to!"),null;const o=new d,s=new d,f=()=>{((e,t,n)=>{p(e)&&Reveal.addEventListener("slidechanged",(i=>{i.previousSlide&&(t.push({presentationId:e.apiConfig.presentationId,presentationUrl:window.location.href.replace(/(#(.+)?)/,""),timestamp:(new Date).toISOString(),slideNumber:c(i.previousSlide),dwellTime:n.getTime()}),n.reset())}))})(n,i.logSlideViewEvents,s),((e,{logPresentationViewEvents:t,logSlideViewEvents:n,logLinkActionEvents:i,logMediaActionEvents:o,logQuizActionEvents:s},r)=>{window.addEventListener("beforeunload",(()=>{const a=window.location.href.replace(/(#(.+)?)/,"");t.push({presentationId:e.apiConfig.presentationId,presentationUrl:a,timestamp:(new Date).toISOString(),finalProgress:Reveal.getProgress(),totalDwellTime:u(e)?r.getTime():null});const l={logPresentationViewEvents:t,logSlideViewEvents:n,logLinkActionEvents:i,logMediaActionEvents:o,logQuizActionEvents:s};e.debug&&console.log("ðŸš€ ~ sending events:",l),navigator.sendBeacon(e.apiConfig.trackingAPI,JSON.stringify(l))}))})(n,i,o),((n,i)=>{(g(n)||m(n))&&document.addEventListener("click",(o=>{const s=Reveal.getCurrentSlide();if(!Array.from(s.querySelectorAll("a")).includes(o.target))return;const r=window.location.href.replace(new RegExp(window.location.hash)||"",""),a=o.target.href.replace(r,""),l=a.startsWith("#");if(l&&g(n)||!l&&m(n)){const r=l?e:t,d=l?a:o.target.href;i.push({presentationId:n.apiConfig.presentationId,presentationUrl:window.location.href.replace(/(#(.+)?)/,""),timestamp:(new Date).toISOString(),slideNumber:c(s),linkType:r,linkUrl:d,linkText:o.target.text.trim()})}}))})(n,i.logLinkActionEvents),h(n,i.logMediaActionEvents),((e,t)=>{if(!e.revealDependencies.quiz)return;const n={},i=Reveal.getConfig().quiz||{};i.events=i.events||{};const o=()=>{const i=Reveal.getCurrentSlide(),o=i.querySelector("[data-quiz]");if(!o)return!0;const s=o.dataset.quiz,a=window[s];if(!a)return!0;n[s]instanceof d?n[s].reset():(n[s]=new d,n[s].start());const l={quizId:s,quizName:a.info.name,numberOfQuestions:a.questions.length,presentationId:e.apiConfig.presentationId,presentationUrl:window.location.href.replace(/(#(.+)?)/,"")};return t.push({timestamp:(new Date).toISOString(),slideNumber:c(i),actionType:r,...l}),!0},s=i=>{const o=Reveal.getCurrentSlide(),s=o.querySelector("[data-quiz]");if(!s)return!0;const r=s.dataset.quiz,l=window[r];if(!l)return!0;let u;n[r]instanceof d&&(u=n[r].getTime(),n[r].clear());const p={quizId:r,quizName:l.info.name,numberOfQuestions:l.questions.length,presentationId:e.apiConfig.presentationId,presentationUrl:window.location.href.replace(/(#(.+)?)/,"")};return t.push({timestamp:(new Date).toISOString(),actionType:a,slideNumber:c(o),dwellTime:u,completed:!0,score:i.score,...p}),!0};if(i.events.onStartQuiz){const e=i.events.onStartQuiz;i.events.onStartQuiz=()=>{o(),e()}}else i.events.onStartQuiz=o;if(i.events.onCompleteQuiz){const e=i.events.onCompleteQuiz;i.events.onCompleteQuiz=t=>{s(t),e(t)}}else i.events.onCompleteQuiz=s;"function"==typeof prepareQuizzes&&prepareQuizzes(i)})(n,i.logQuizActionEvents)};return{id:"pp-tracking",init:()=>{f(),o.start(),p(n)&&s.start(),n.debug&&(console.log("Initialized pp-tracking plugin"),console.log("Plugin Config:",n))}}}}));
